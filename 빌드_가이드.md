# RustDesk Windows 빌드 및 배포 가이드

## 빠른 시작

### 기본 빌드 (서명 없음)

```cmd
build_windows.bat
```

### 코드 서명 포함 빌드

```cmd
set CERT_PASSWORD=인증서_패스워드
set CERT_FILE=cert.pfx
build_windows.bat
```

또는

```cmd
set CERT_PASSWORD=인증서_패스워드
build_windows_signed.bat
```

## 단계별 설명

### 1단계: 전체 빌드 실행

`build.py --flutter` 명령으로 Rust와 Flutter를 통합 컴파일합니다.

**수동 실행:**
```cmd
python build.py --flutter
```

**빌드 과정:**
- Rust 라이브러리 컴파일 (`librustdesk.dll`)
- Flutter 앱 빌드 (`rustdesk.exe`)
- 가상 디스플레이 DLL 복사
- 포터블 패키저로 설치 프로그램 생성

**출력 위치:**
- 실행 파일: `flutter\build\windows\x64\runner\Release\rustdesk.exe`
- 설치 프로그램: `rustdesk-{version}-install.exe`

### 2단계: 디지털 서명 (선택적, 상용화 시 필수)

EV Code Signing 인증서를 사용하여 Windows 경고창을 제거합니다.

**환경변수 설정:**
```cmd
set CERT_PASSWORD=인증서_패스워드
set CERT_FILE=cert.pfx
```

**서명 대상:**
- `rustdesk.exe` (메인 실행 파일)
- `rustdesk-{version}-install.exe` (설치 프로그램)

**서명 명령어 (수동):**
```cmd
signtool sign /a /v /p %CERT_PASSWORD% /f %CERT_FILE% /t http://timestamp.digicert.com "파일경로"
```

**서명 검증:**
```cmd
signtool verify /pa /v "파일경로"
```

### 3단계: 배포 파일 생성

빌드 완료 후 다음 파일이 자동 생성됩니다:

- **실행 파일**: `flutter\build\windows\x64\runner\Release\rustdesk.exe`
- **설치 프로그램**: `rustdesk-{version}-install.exe` (프로젝트 루트)

## 코드 서명 인증서 준비

### 인증서 구매

상용 배포를 위해서는 신뢰할 수 있는 인증 기관에서 EV Code Signing 인증서를 구매해야 합니다.

**주요 인증 기관:**
- DigiCert
- Sectigo (이전 Comodo)
- GlobalSign
- SSL.com

### 인증서 파일 준비

1. 인증서를 `.pfx` 형식으로 내보내기
2. 프로젝트 루트에 `cert.pfx`로 저장하거나 `CERT_FILE` 환경변수로 경로 지정

### Windows에서 인증서 내보내기

1. 인증서 관리자 실행 (`certmgr.msc`)
2. "개인" → "인증서"에서 인증서 선택
3. 마우스 우클릭 → "모든 작업" → "내보내기"
4. "개인 키과 함께 내보내기" 선택
5. `.pfx` 형식 선택
6. 패스워드 설정

## 문제 해결

### 빌드 실패

**Rust 컴파일 오류:**
```cmd
cargo clean
python build.py --flutter
```

**Flutter 빌드 오류:**
```cmd
cd flutter
flutter clean
flutter pub get
cd ..
python build.py --flutter
```

### 서명 실패

**signtool을 찾을 수 없음:**
- Windows SDK 설치 확인
- Visual Studio Build Tools 설치 확인

**인증서 오류:**
- 인증서 파일 경로 확인
- 인증서 패스워드 확인
- 인증서 형식 확인 (.pfx)

### 설치 프로그램이 생성되지 않음

```cmd
cd libs\portable
pip3 install -r requirements.txt
cd ..\..
python build.py --flutter
```

## 빌드 스크립트 설명

### build_windows.bat

기본 빌드 스크립트:
- 전체 빌드 실행
- 코드 서명 (환경변수 설정 시)
- 배포 파일 확인

### build_windows_signed.bat

코드 서명 필수 빌드 스크립트:
- 인증서 정보 필수 확인
- 전체 빌드 실행
- 코드 서명 및 검증
- 배포 파일 확인

## 환경변수

| 변수명 | 설명 | 필수 | 기본값 |
|--------|------|------|--------|
| `CERT_PASSWORD` | 인증서 패스워드 | 서명 시 | - |
| `CERT_FILE` | 인증서 파일 경로 | 서명 시 | `cert.pfx` |
| `P` | 인증서 패스워드 (호환성) | 서명 시 | - |

## 출력 파일

빌드 완료 후 생성되는 파일:

```
rustdesk/
├── flutter/
│   └── build/
│       └── windows/
│           └── x64/
│               └── runner/
│                   └── Release/
│                       └── rustdesk.exe          (메인 실행 파일)
└── rustdesk-{version}-install.exe                 (설치 프로그램)
```

## 다음 단계

1. **테스트 실행**
   ```cmd
   flutter\build\windows\x64\runner\Release\rustdesk.exe
   ```

2. **설치 프로그램 테스트**
   ```cmd
   rustdesk-{version}-install.exe
   ```

3. **배포 준비**
   - 설치 프로그램 배포
   - 코드 서명된 파일은 Windows Defender SmartScreen 경고 없이 실행 가능

## 참고 사항

- 코드 서명은 Windows Defender SmartScreen 경고를 제거하는 데 필수입니다
- EV Code Signing 인증서는 하드웨어 토큰(USB)이 필요할 수 있습니다
- 타임스탬프 서버를 사용하면 인증서 만료 후에도 서명이 유효합니다
- 빌드 시간은 시스템 성능에 따라 다릅니다 (일반적으로 10-30분)

## 추가 리소스

- [상세 빌드 가이드](BUILD_WINDOWS.md)
- [RustDesk 공식 문서](https://rustdesk.com/docs/en/dev/build/)
- [Windows 코드 서명 가이드](https://docs.microsoft.com/en-us/windows/win32/seccrypto/cryptography-tools)

